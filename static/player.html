<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>File Details</title>
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <style>
        /* Always Dark Mode */
        html, body {
            margin: 0;
            background-color: #000 !important;
            color: #f1f1f1 !important;
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        }
        a, button { color: inherit; }

        .wrapper {
            max-width: 900px;
            margin: 0 auto;
            padding: 1.5rem 1rem;
            text-align: center;
        }

        /* Info */
        .info-container {
            margin-top: 1.2rem;
            background: #0f0f0f;
            padding: 1.2rem;
            border-radius: .5rem;
            border: 1px solid #222;
        }

        #file-name {
            font-size: 1.25rem;
            margin: 0;
            white-space: normal;
            overflow-wrap: anywhere;
            word-break: break-word;
        }

        #file-size { margin-top: .3rem; color: #aaa; }

        .actions-container {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .btn-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            min-width: 100px;
            background-color: #222;
            border: 1px solid #444;
            border-radius: 0.5rem;
            text-decoration: none;
            color: #f1f1f1;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }
        
        .btn-icon:hover {
            background-color: #333;
            color: #fff;
            text-decoration: none;
        }

        .btn-icon i {
            font-size: 1.75rem;
        }

        @media (max-width: 576px) {
            .wrapper { padding: 1rem .6rem; }
        }
    </style>
</head>
<body>
    <div class="wrapper">

        <div class="info-container">
            <h3 id="file-name" title=""></h3>
            <p id="file-size"></p>
            
            <div class="actions-container">
                <a id="download-btn" class="btn-icon" href="#" target="_blank">
                    <i class="bi bi-download"></i>
                    <span>Download</span>
                </a>
                <button id="copy-stream-link-btn" class="btn-icon">
                    <i class="bi bi-clipboard"></i>
                    <span>Copy Link</span>
                </button>
                <a id="vlc-btn" class="btn-icon" href="#" target="_blank">
                    <i class="bi bi-cone-striped"></i>
                    <span>VLC</span>
                </a>
                <a id="mx-player-btn" class="btn-icon" href="#" target="_blank">
                    <i class="bi bi-play-circle"></i>
                    <span>MX Player</span>
                </a>
                <a id="mx-pro-btn" class="btn-icon" href="#" target="_blank">
                    <i class="bi bi-play-circle-fill"></i>
                    <span>MX Player Pro</span>
                </a>
            </div>
        </div>

    </div>

    <!-- Player + subtitle + wake-lock + nosleep + resume -->
    <script>
    (async () => {
        const rawFile = window.location.pathname.split('/').pop() || '';
        const encoded = encodeURIComponent(rawFile);
        const fileNameEl = document.getElementById('file-name');

        // make breakable filename (zero-width after dots)
        function makeBreakableName(name) {
            if (!name) return '';
            return name.replace(/\./g, '.\u200B');
        }

        function setupButtonActions() {
            const streamUrl = `${location.origin}/stream/${encoded}`;
            
            // Direct links
            document.getElementById('download-btn').href = streamUrl;
            document.getElementById('mx-player-btn').href = `/play/mx/${encoded}`;
            document.getElementById('mx-pro-btn').href = `/play/mxpro/${encoded}`;
            document.getElementById('vlc-btn').href = `/play/vlc/${encoded}`;

            // Clipboard
            const copyBtn = document.getElementById('copy-stream-link-btn');
            const copyBtnText = copyBtn.querySelector('span');
            copyBtn.onclick = () => {
                navigator.clipboard.writeText(streamUrl).then(() => {
                    const originalText = copyBtnText.innerText;
                    copyBtnText.innerText = 'Copied!';
                    setTimeout(() => {
                        copyBtnText.innerText = originalText;
                    }, 2000);
                }).catch(() => {
                    alert('Could not copy automatically. Please copy this URL: ' + streamUrl);
                });
            };
        }

        async function fetchDetails() {
            try {
                const res = await fetch(`/details/${encoded}`);
                if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                const details = await res.json();

                const originalName = details.file_name || rawFile;
                const breakableName = makeBreakableName(originalName);
                fileNameEl.innerText = breakableName;
                fileNameEl.title = originalName;
                document.getElementById('file-size').innerText = details.file_size || '';
            } catch (error) {
                console.error("Failed to fetch file details:", error);
                const fallbackName = makeBreakableName(rawFile);
                fileNameEl.innerText = fallbackName;
                fileNameEl.title = rawFile;
                document.getElementById('file-size').innerText = 'Unknown size';
            }
        }

        setupButtonActions();
        fetchDetails();
    })();
    </script>
</body>
</html>
